var wrtcClient;var wrtcEventListener=undefined;var wrtcConfiguration=undefined;var localStream;var remoteMedia;var username;var inCall=false;function WrtcEventListener(a){if(a.debugEnabled){}this.device=a}WrtcEventListener.prototype.onWebRTCommClientOpenedEvent=function(){if(this.device.debugEnabled){}this.device.status="ready";this.device.onReady(this.device)};WrtcEventListener.prototype.onWebRTCommClientOpenErrorEvent=function(a){if(this.device.debugEnabled){}this.device.onError("Error setting up Device"+a)};WrtcEventListener.prototype.onWebRTCommClientClosedEvent=function(){if(this.device.debugEnabled){}this.device.onOffline(this.device)};WrtcEventListener.prototype.onGetUserMediaErrorEventHandler=function(a){if(this.device.debugEnabled){}this.device.onError("Media error: "+a)};WrtcEventListener.prototype.onWebRTCommCallRingingEvent=function(a){if(this.device.debugEnabled){}if(a.incomingCallFlag==true){this.device.connection=new Connection(this.device,"pending");this.device.connection.isIncoming=true;this.device.connection.parameters={From:a.callerPhoneNumber,To:wrtcConfiguration.sip.sipUserName,"Custom-Headers":a.customHeaders,};this.device.connection.webrtcommCall=a;var b=this;this.device.onIncoming(this.device.connection);if(this.device.sounds.incomingEnabled){this.device.sounds.audioRinging.play()}this.device.status="busy"}};WrtcEventListener.prototype.onWebRTCommCallInProgressEvent=function(a){if(this.device.debugEnabled){}};WrtcEventListener.prototype.onWebRTCommCallRingingBackEvent=function(a){if(this.device.debugEnabled){}if(this.device.sounds.outgoingEnabled){this.device.sounds.audioCalling.play()}this.device.connection.webrtcommCall=a};WrtcEventListener.prototype.onWebRTCommCallOpenErrorEvent=function(b,a){if(this.device.debugEnabled){}if(this.device.connection){this.device.connection.onError("Error connecting "+a)}};WrtcEventListener.prototype.onWebRTCommCallErrorEvent=function(b,a){if(this.device.debugEnabled){}if(this.device.connection){this.device.connection.onError("Error in call: "+a)}};WrtcEventListener.prototype.onWebRTCommCallClosedEvent=function(a){if(this.device.debugEnabled){}this.device.status="ready";this.device.connection.status="closed";this.device.connection.stats=a.stats;this.device.connection.onDisconnect(this.device.connection);if(this.device.onDisconnect!=null){this.device.onDisconnect(this.device.connection)}};WrtcEventListener.prototype.onWebRTCommCallOpenedEvent=function(a){if(this.device.debugEnabled){}this.device.connection.webrtcommCall=a;remoteMedia.src=URL.createObjectURL(a.getRemoteBundledAudioVideoMediaStream()||a.getRemoteVideoMediaStream()||a.getRemoteAudioMediaStream());if(this.device.connection.isIncoming){this.device.sounds.audioRinging.pause()}else{this.device.sounds.audioCalling.pause()}this.device.connection.status="open";this.device.onConnect(this.device.connection);inCall=true};WrtcEventListener.prototype.onWebRTCommCallCanceledEvent=function(a){if(this.device.debugEnabled){}this.device.sounds.audioRinging.pause();this.device.connection.webrtcommCall=undefined;this.device.onCancel(this.device.connection)};WrtcEventListener.prototype.onWebRTCommCallHangupEvent=function(a){if(this.device.debugEnabled){}this.device.connection.webrtcommCall=undefined};WrtcEventListener.prototype.onWebRTCommCallStatsEvent=function(a,b){if(this.device.debugEnabled){}if(this.device.connection.onStats!=null){this.device.connection.onStats(b)}};WrtcEventListener.prototype.onWebRTCommMessageReceivedEvent=function(b){if(this.device.debugEnabled){}if(this.device.sounds.outgoingEnabled){this.device.sounds.audioMessage.play()}var a={From:b.from,Text:b.text,};this.device.onMessage(a)};WrtcEventListener.prototype.onWebRTCommMessageSentEvent=function(a){if(this.device.debugEnabled){}};WrtcEventListener.prototype.onWebRTCommMessageSendErrorEvent=function(b,a){if(this.device.debugEnabled){}this.device.onError("Error sending text message: "+a)};function Connection(b,a){this.device=b;this.status=a;this.muted=false;this.videoMuted=false;this.onError=null;this.onDisconnect=null;this.onStats=null;this.onMute=null;this.onMuteVideo=null;this.isIncoming=false;this.parameters=null;this.webrtcommCall=undefined}Connection.prototype.accept=function(b){if(this.device.debugEnabled){}this.device.sounds.audioRinging.pause();remoteMedia=b["remote-media"];this.parameters["video-enabled"]=b["video-enabled"];if(!b["fake-media"]){b["fake-media"]=false}var a=this;getUserMedia({audio:true,video:b["video-enabled"],fake:b["fake-media"]},function(d){if(a.debugEnabled){}b["local-media"].src=URL.createObjectURL(d);localStream=d;var c={displayName:wrtcConfiguration.sip.sipDisplayName,localMediaStream:localStream,audioMediaFlag:true,videoMediaFlag:b["video-enabled"],messageMediaFlag:false,audioCodecsFilter:"",videoCodecsFilter:""};if(a.webrtcommCall){a.webrtcommCall.accept(c);a.status="open"}if(localStream.getVideoTracks().length>0){if(a.debugEnabled){}}if(localStream.getAudioTracks().length>0){if(a.debugEnabled){}}},function(c){a.onError("Error in getUserMedia()"+c)})};Connection.prototype.sendDigits=function(a){if(this.device.debugEnabled){}if(this.webrtcommCall){this.webrtcommCall.sendDTMF(a)}};Connection.prototype.error=function(a){if(this.device.debugEnabled){}this.onError=a};Connection.prototype.disconnect=function(a){if(a!==undefined){if(this.device.debugEnabled){}this.onDisconnect=a}else{if(this.device.debugEnabled){}if(inCall){this.webrtcommCall.close();this.webrtcommCall=undefined;inCall=false}else{this.device.sounds.audioRinging.pause();this.device.sounds.audioCalling.pause()}}};Connection.prototype.getStats=function(a){if(this.device.debugEnabled){}this.onStats=a;this.webrtcommCall.getStats()};Connection.prototype.mute=function(a){if(typeof a=="function"){var d=a;if(this.device.debugEnabled){}this.onMute=d}else{var c=a;if(this.device.debugEnabled){}if(this.webrtcommCall){if(c){this.webrtcommCall.muteLocalAudioMediaStream()}else{this.webrtcommCall.unmuteLocalAudioMediaStream()}this.muted=c;var b=this;setTimeout(function(){b.onMute(c,b)},1)}}};Connection.prototype.muteVideo=function(a){if(typeof a=="function"){var d=a;if(this.device.debugEnabled){}this.onMuteVideo=d}else{var c=a;if(this.device.debugEnabled){}if(this.webrtcommCall){if(c){this.webrtcommCall.hideLocalVideoMediaStream()}else{this.webrtcommCall.showLocalVideoMediaStream()}this.videoMuted=c;var b=this;setTimeout(function(){b.onMuteVideo(c,b)},1)}}};Connection.prototype.reject=function(){this.device.sounds.audioRinging.pause();this.webrtcommCall.reject();this.status="closed";this.device.status="ready"};Connection.prototype.ignore=function(){this.device.sounds.audioRinging.pause();this.webrtcommCall.ignore();this.status="closed";this.device.status="ready"};Connection.prototype.status=function(){return this.status};Connection.prototype.parameters=function(){return this.parameters};var RestCommClient={Device:{onReady:null,onError:null,onConnect:null,onIncoming:null,onMessage:null,onDisconnect:null,onOffline:null,onCancel:null,onPresence:null,status:"offline",connection:null,debugEnabled:false,sounds:{soundRinging:"scripts/sounds/ringing.mp3",soundCalling:"scripts/sounds/calling.mp3",soundMessage:"scripts/sounds/message.mp3",audioRinging:null,audioCalling:null,audioMessage:null,incomingEnabled:true,outgoingEnabled:true,disconnectEnabled:true,incoming:function(a){if(typeof a=="boolean"){this.incomingEnabled=a}else{return this.incomingEnabled}},outgoing:function(a){if(typeof a=="boolean"){this.outgoingEnabled=a}else{return this.outgoingEnabled}},disconnect:function(a){if(typeof a=="boolean"){this.disconnectEnabled=a}else{return this.disconnectEnabled}},},setup:function(b){if("debug" in b&&b.debug==true){this.debugEnabled=true}if(this.debugEnabled){}var a=true;if("register" in b&&b.register==false){a=false}if(!b.registrar||b.registrar==""){b.registrar="wss://cloud.restcomm.com:5063"}if(!b.domain||b.domain==""){b.domain="cloud.restcomm.com"}wrtcConfiguration={communicationMode:WebRTCommClient.prototype.SIP,sip:{sipUserAgent:"TelScale RestComm Web Client 1.0.0 BETA4",sipRegisterMode:a,sipOutboundProxy:b.registrar,sipDomain:b.domain,sipDisplayName:b.username,sipUserName:b.username,sipLogin:b.username,sipPassword:b.password,},RTCPeerConnection:{iceServers:undefined,stunServer:"stun.l.google.com:19302",turnServer:undefined,turnLogin:undefined,turnPassword:undefined,}};username=b.username;this.sounds.audioRinging=new Audio(this.sounds.soundRinging);this.sounds.audioRinging.loop=true;this.sounds.audioCalling=new Audio(this.sounds.soundCalling);this.sounds.audioCalling.loop=true;this.sounds.audioMessage=new Audio(this.sounds.soundMessage);wrtcEventListener=new WrtcEventListener(this);wrtcClient=new WebRTCommClient(wrtcEventListener);wrtcClient.open(wrtcConfiguration)},ready:function(a){if(this.debugEnabled){}this.onReady=a},incoming:function(a){if(this.debugEnabled){}this.onIncoming=a},offline:function(a){if(this.debugEnabled){}this.onOffline=a},cancel:function(a){if(this.debugEnabled){}this.onCancel=a},message:function(a){if(this.debugEnabled){}this.onMessage=a},presence:function(a){if(this.debugEnabled){}this.onPresence=a},error:function(a){if(this.debugEnabled){}this.onError=a},connect:function(b,a){if(typeof b=="function"){if(this.debugEnabled){}var f=b;this.onConnect=f}else{if(this.debugEnabled){}var e=b;var c=a;remoteMedia=e["remote-media"];this.connection=new Connection(this,"connecting");this.connection.parameters={From:wrtcConfiguration.sip.sipUserName,To:e.username,"video-enabled":e["video-enabled"],};if(!e["fake-media"]){e["fake-media"]=false}var d=this;getUserMedia({audio:true,video:e["video-enabled"],fake:e["fake-media"]},function(h){if(d.debugEnabled){}e["local-media"].src=URL.createObjectURL(h);localStream=h;var g={displayName:wrtcConfiguration.sip.sipDisplayName,localMediaStream:localStream,audioMediaFlag:true,videoMediaFlag:e["video-enabled"],messageMediaFlag:false,audioCodecsFilter:"",videoCodecsFilter:""};d.connection.webrtcommCall=wrtcClient.call(e.username,g);d.status="busy";if(localStream.getVideoTracks().length>0){if(d.debugEnabled){}}if(localStream.getAudioTracks().length>0){if(d.debugEnabled){}}},function(g){d.onError("Error in getUserMedia()"+g)});return this.connection}},sendMessage:function(a){if(this.debugEnabled){}wrtcClient.sendMessage(a.username,a.message)},disconnect:function(a){if(this.debugEnabled){}this.onDisconnect=a},disconnectAll:function(){if(this.debugEnabled){}this.connection.disconnect();if(this.onDisconnect){this.onDisconnect(this)}},status:function(){if(this.debugEnabled){}return this.status},activeConnection:function(){if(this.debugEnabled){}return this.connection},destroy:function(){if(this.debugEnabled){}wrtcClient.close();this.status="offline"}}};